/**
 * main.c
 */
//
// Included Files
//
//=====================================================================================================================
#include "F28x_Project.h"



// ----------------------------------------------------------------------
// 全局变量
// ----------------------------------------------------------------------

// 主函数入口
int main(void)
{

        // Step 1. 系统控制初始化:
        // 初始化PLL锁相环、看门狗、使能外设时钟
        // 此函数位于f28004x_sysctrl.c文件中
        // 初始化后系统主频为100MHz，并开启所有外设时钟
        //=======================================================================
        InitSysCtrl();//主频 100M 并开启所有外设的时钟

        //
        // Step 2. 硬件初始化:
        // 初始化开发板上的外设电路和调试接口
        //=======================================================================
        InitBoard();   // 对使用的硬件电路初始化(如GPIO、外设等)
        InitDebug();   // 初始化调试串口（使用SCIA端口）

        // Step 2.1. CPU定时器初始化与配置:
        // 系统主频 = 100MHz
        // 初始化三个CPU定时器并设置不同频率
        //=========================================================================
        InitCpuTimers();                         // 初始化所有CPU定时器
        ConfigCpuTimer(&CpuTimer0, 100, 1000);   // 配置定时器0为1kHz (周期1ms)
        ConfigCpuTimer(&CpuTimer1, 100, 10000);  // 配置定时器1为100Hz (周期10ms)
        ConfigCpuTimer(&CpuTimer2, 100, 100000); // 配置定时器2为10Hz (周期100ms)

        // Step 3. 中断系统初始化:
        // 禁用CPU中断，初始化PIE控制器和中断向量表
        //=========================================================================
        DINT;                  // 禁用全局中断

        // 初始化PIE控制寄存器到默认状态（所有PIE中断禁用，标志位清零）
        InitPieCtrl();

        IER = 0x0000;              // 禁用CPU级别中断
        IFR = 0x0000;              // 清除所有CPU中断标志

        InitPieVectTable();        // 初始化PIE中断向量表

        // Step 3.1. 用户中断配置:
        // 配置特定的CPU和PIE中断
        //=========================================================================
        IER |= M_INT1;               // 使能CPU级别INT1中断（对应PIE组1）

        PieCtrlRegs.PIEIER1.bit.INTx1 = 1;      // 使能PIE组1中的第1个中断（ADCA1中断）
        PieCtrlRegs.PIEACK.all = PIEACK_GROUP1; // 清除PIE组1的中断应答位，允许接收新中断

        // Step 3.2. 全局中断使能:
        // 使能全局中断和实时调试事件
        //=========================================================================
        EINT;                     // 使能全局中断
        ERTM;                    // 使能实时调试事件

        // Step 4. 用户代码初始化:






        // Step 5. ePWM时钟同步启动:
        // 启动所有ePWM模块的时基时钟同步
        //=========================================================================
        EALLOW;
        CpuSysRegs.PCLKCR0.bit.TBCLKSYNC = 1;  // 启动所有ePWM时基时钟同步
        EDIS;


        // Step 6. 主循环:
        // 应用程序主循环，处理ADCA1中断标志并发送调试数据
        //=========================================================================
        while(1)
        {


        }

}


